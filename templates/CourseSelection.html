<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>選課系統</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='course.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>

    <h1>選課系統</h1>
    <!-- 加選表單 -->
    <h2>加選課程</h2>
    <!-- 顯示系所課程 -->
    <form id="selectForm" action="/get_courses" method="POST">
        <label for="course">選擇系所：</label>
        <select id="course" name="course">
            <!--內容先少少的-->
            <option value="0">資訊工程學系</option>
            <option value="1">電機工程學系</option>
        </select>
        <button type="button" id="submitButton">選擇</button>
    </form>
    <!-- 顯示課程表格 -->
    <div id="dataDisplay"></div>

    <!-- 退選表單 -->
    <h2>已選課程</h2>
    <ul id="selected-courses">
        <!-- 顯示已選擇的課程 -->
        <table>
            <tr>
                <th></th>
                <th>一</th>
                <th>二</th>
                <th>三</th>
                <th>四</th>
                <th>五</th>
            </tr>
            <tr>
                <th>1</th>
                <td>1-1</td>
                <td>1-2</td>
                <td>1-3</td>
                <td>1-4</td>
                <td>1-5</td>
            </tr>
            <tr>
                <th>2</th>
                <td>2-1</td>
                <td>2-2</td>
                <td>2-3</td>
                <td>2-4</td>
                <td>2-5</td>
            </tr>
            <tr>
                <th>3</th>
                <td>3-1</td>
                <td>3-2</td>
                <td>3-3</td>
                <td>3-4</td>
                <td>3-5</td>
            </tr>
            <tr>
                <th>4</th>
                <td>4-1</td>
                <td>4-2</td>
                <td>4-3</td>
                <td>4-4</td>
                <td>4-5</td>
            </tr>
            <tr>
                <th>5</th>
                <td>5-1</td>
                <td>5-2</td>
                <td>5-3</td>
                <td>5-4</td>
                <td>5-5</td>
            </tr>
            <tr>
                <th>6</th>
                <td>6-1</td>
                <td>6-2</td>
                <td>6-3</td>
                <td>6-4</td>
                <td>6-5</td>
            </tr>
            <tr>
                <th>7</th>
                <td>7-1</td>
                <td>7-2</td>
                <td>7-3</td>
                <td>7-4</td>
                <td>7-5</td>
            </tr>
            <tr>
                <th>8</th>
                <td>8-1</td>
                <td>8-2</td>
                <td>8-3</td>
                <td>8-4</td>
                <td>8-5</td>
            </tr>

            </tr>
        </table>
    </ul>
    <form action="#" method="POST">
        <label for="selected-course">選擇要退選的課程：</label>
        <select id="selected-course" name="selected-course">
            <!-- 這裡將動態添加已選擇的課程選項 -->
        </select>
        <button type="submit">退選</button>
    </form>

    <script>
        // 確保網頁已經載入完畢
        $(document).ready(function () {
            // 當使用者按下選擇按鈕時
            $("#submitButton").click(function (event) {
                // 防止表單預設的提交行為
                event.preventDefault();
                // 發送異步的HTTP請求 發送了一個POST請求到URL為'/get_courses'的後端接口，並將表單數據序列化後作為請求數據
                $.ajax({
                    url: '/get_courses',
                    type: 'POST',
                    data: $('#selectForm').serialize(),
                    // 指定請求成功時要執行的函數
                    success: function (response) {
                        var courses = response;
                        var html = '';
                        for (var i = 0; i < courses.length; i++) {
                            // 將 button 賦予 data-id 為該課程相對應的 course_id
                            html += '<tr><td>' + courses[i].course_name + '</td><td>' + courses[i].credit + '</td><td>' + courses[i].grade +
                                '</td><td>' + courses[i].description + '</td><td><button data-id="' + courses[i].course_id + '" class="select-course">選擇</button></td></tr>';
                        }
                        // 將動態生成的課程表插入到頁面中
                        $('#dataDisplay').html('<table>' + html + '</table>');
                    }
                });
            });
            // 將所輸入的回傳給後端
            $(document).on('click', '.select-course', function () {
                // 指定 data-id 為要回傳的值
                var courseId = $(this).attr('data-id');
                $.ajax({
                    url: '/add_course',
                    type: 'POST',
                    data: { course_id: courseId.toString()}, // 將選擇的課程ID作為數據傳遞給後端
                    success: function (response) {
                        // 顯示添加成功的提示
                        alert('課程添加成功! 選擇的課程ID為:' + courseId);
                    }
                });
            });
        });

    </script>
</body>